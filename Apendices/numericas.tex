\chapter{Resoluci\'on num\'erica: Teor\'ia Molecular}\label{sec:film:reso-numerica}


\section{Films polim\'ericos: simetr\'ia plana}

La obtenci\'on de resultados a partir de la teor\'ia planteada en los cap\'itulos \ref{Chapter-film} y \ref{Chapter-esfericas} requiere la soluci\'on num\'erica de ecuaciones integro-diferenciales. Para tal prop\'osito es conveniente pasar de un sistema continuo a uno discreto. 
Todas las cantidades planteadas en este anexo son definidas en el cap\'itulo \ref{Chapter-film}, secci\'on \ref{sec:film-teoria}, siendo trabajadas aqu\'i en un sistema discreto.
La discretizaci\'on de nuestro problema se realiza en capas de espesor $\delta$. 
En particular, para el cap\'itulo \ref{Chapter-film}, la suma sobre cada uno de estas capas reemplazan a las integrales a lo largo del eje $z$, esto se debe a la simetr\'ia sobre los ejes $x$ e $y$ que se ha utilizado para el desarrollo de la TM para hidrogeles de films polim\'ericos.


Por ejemplificar este cambio, la ecuaci\'on de incompresibilidad expresada en ec. \ref{eq:film:constraint} es reescrita como:


\begin{align}
	\begin{aligned}
		1=  {\left[\sum_{\gamma}\rho_\gamma(i_z) v_\gamma + \sum_\lambda{\left<\rho_{ads,\lambda}(i_z)\right>v_\lambda} + \left<\rho_{MAA}(i_z)\right>v_{MAA} \right]},~ con \quad  i_z =1,2,3.., n_z
	\end{aligned}
	\label{eq:film:discreto-constraint}
\end{align}

Esta expresi\'on nos permite resolverla en cada una de las capas $i_z$, cuya posici\'on es descrita usando la coordenada $z_i = (i_z -$0.5$)\delta$, lo cual las ubica en el centro de cada capa. $i_z$ toma los valores de 1 a $n_z$, donde se toma a $n_z$ lo suficientemente grande para que las densidades de cada una de las especies involucradas, as\'i como tambi\'en el potencial electrost\'atico, converjan a sus valores en el ba\~no de la soluci\'on (el bulk de la soluci\'on).
Es decir: $\rho_\gamma(n_z) = \rho^b_\gamma$, $\rho_{ads}(\theta,n_z) = \rho^b_{ads}(\theta)$ y $\psi(n_z) = \psi^b =0$.
Para valores de $n_z \geq 500$ es posible obtener estas condiciones.

Reescribiendo las expresiones de los funcionales de la secci\'on \ref{sec:film-teoria}, obtenemos para la densidad discreta de las especies libres:

\begin{align}
	\rho_\gamma(i_z)v_w = a_\gamma \exp\left[-\beta q_\gamma\psi(i_z)\right] \exp\left[-\beta v_\gamma\pi(i_z)\right]
\end{align}


El grado de disociaci\'on para los segmentos de MAA que componen la red polim\'erica de nuestro film, de la ecuaci\'on \ref{eq:film:degree-film}:

\begin{align}
	\frac{f(i_z)}{1-f(i_z)} = \left(\frac{a_{H^+}}{K^0_{a,MAA}}\right)^{- 1} \exp[-\beta q_{MAA} \psi(i_z)]
\end{align}

An\'alogamente, para unidades del adsorbato, ecuaci\'on \ref{eq:film:degree-protein}:

\begin{align}
	\frac{f_\tau(i_z)}{1-f_\tau(i_z)} = \left(\frac{a_{H^+}}{K^0_{a,\tau}}\right)^{\mp 1} \exp[-\beta q_\tau \psi(i_z)]
\end{align}

\noindent en donde $\tau$ hace referencia a los segmentos del adsorbato. Y en la que se tiene en cuenta que el exponente $-1$, para segmentos \'acidos y  $+1$ para los b\'asicos.

La densidad de los segmentos que compone la red polim\'erica se expresa como:
\begin{align}
	\left< \rho_{MAA}(i_z)\right> = \sum_\alpha P(\alpha)\rho_{MAA}(\alpha, i_z)
\end{align}

En donde se redefine $P(\alpha)$:


\begin{align}
	\begin{aligned}
		P(\alpha) = &\frac{1}{Q}\exp\left[ -A \delta \sum^{n_z}_{i_z = 1} \rho_{MAA}(\alpha, i_z) \ln f(i_z)\right] \\
		%%%%
		&\exp\left[ -A\delta \sum^{n_z}_{i_z = 1}  \rho_{MAA}(\alpha, i_z) \beta q_{MAA} \psi(i_z)\right] \\
		& \exp\left[ -A\delta \sum^{n_z}_{i_z = 1}  \rho_{MAA}(\alpha, i_z) \beta v_{MAA} \pi(i_z)\right] 
	\end{aligned}
\end{align}

\noindent en donde $\psi(i_z)$ y $\pi(i_z)$ son los valores discretos de estos potenciales de interacci\'on. Adem\'as $\rho_{MAA}(\alpha, i_z)$ es la distribuci\'on discreta para una conformaci\'on $\alpha$, la cual es provista por el modelo molecular a usar.

La densidad discreta del adsorbato  se expresa como:


\begin{align}
	\begin{aligned}
		\rho_{ads}(\theta, i_z)v_w = &\tilde{a}_{ads} \prod_\tau\exp\left[-A \delta \sum^{n_z}_{j_z = 1} n_\tau(\theta,i_z,j_z) \ln f_\tau(j_z)\right] \\
		& \prod_\lambda \exp \left[-A \delta \sum^{n_z}_{j_z = 1}  n_\lambda(\theta,i_z, j_z)[v_\lambda\beta\pi(j_z) + q_\lambda \psi(j_z)] \right]
	\end{aligned}
\end{align}

Finalmente discretizando la ecuaci\'on de Poisson, para el pontencial electrost\'atico, obtenemos:

\begin{align}
	\epsilon \frac{\psi(i_z +1) + \Psi(i_z -1) -2\psi(i_z)}{\delta^2} = \left< \rho_q(i_z)\right>
	\label{eq:film:discreto-poisson}
\end{align}

\noindent en esta expresi\'on se ha reemplazado la derivada segunda del potencial electrost\'atico por su diferencia finita. Adem\'as la densidad discreta de carga se define:


\begin{align}
	\left<\rho_q(i_z)\right> = \sum_{\gamma } {\rho_\gamma(i_z) q_\gamma + \sum_\tau{f_\tau(i_z) \left<\rho_{ads,\tau}(i_z)\right> q_\tau} +  f(i_z)\dfrac{\left<\phi_{MAA}(i_z)\right>}{v_{MAA}}q_{MAA}}
	\label{eq:film:rho_charge-discreto}
\end{align}


As\'i como fueron definas las condiciones de contorno en la ecuaci\'on \ref{eq:film:contorno} es necesario redefinirlas para el sistema discreto. Estas condiciones deben satisfacer el desaparici\'on del potencial electrost\'atico en el bulk, lejos del film polim\'erico,  $\psi(n_z) =0 $. Adem\'as se debe cumplir que la derivada del potencial electrost\'atico entre la superficie de soporte y el film se anule.
Para ello es necesario agregar una capa $i_z = 0$, resultando en:
\begin{align}
	\frac{\psi(1) - \psi(0)}{\delta} = 0
\end{align}

\noindent lo que implica que $\psi(0) =  \psi(1)$.

En resumen, dadas las condiciones del bulk de la soluci\'on, o condiciones de laboratorio, compuestas por el pH, concentraci\'on de sal y adsorbatos, temperatura, restar\'ia conocer las cantidades $\psi(i_z)$ y $\pi(i_z)$ para cada capa $i_z$. Cantidades que pueden ser obtenidas al resolver en cada capa las ecuaciones \ref{eq:film:discreto-constraint} y \ref{eq:film:discreto-poisson}.
De esta forma el n\'umero de ecuaciones totales a resolver es $2n_z$ (dos por cada capa). el n\'umero de t\'erminos de cada ecuaci\'on es dependiente de la cantidad de especies involucradas con sus respectivas conformaciones. 
Este sistema de ecuaciones es resuelto usando un m\'etodo de Newton-Krilov donde el jacobiano es calculado num\'ericamente, implementado en c\'odigos FORTRAN desarrollados en el grupo de trabajo.



\section{Teor\'ia molecular de nanogeles polim\'ericos: simetr\'ia esf\'erica}


Para obtener resultados de la minimizaci\'on de la energ\'ia, las ecuaciones integro-diferenciales no lineales descritas en el cap\'itulo \ref{Chapter-esfericas} secciones \ref{sec:esf:tm} y \ref{sec:esf:bulk} deben resolverse num\'ericamente. Para lograr esto, el volumen del sistema se divide en coronas de espesor $\delta = $0.5. En esta divisi\'on se ha considerado una simetr\'ia radial 

En las ecuaciones presentadas, las sumas sobre capas reemplazan las integrales a lo largo de la coordenada $r$, mientras que las diferencias finitas reemplazan las derivadas.

Reescribiendo, la restricci\'on de incomprensibilidad se expresa como:

\begin{align}
	\begin{aligned}
		1=  {\sum_{\gamma}\rho_\gamma(i_r) v_\gamma + \sum_\lambda{\left<\rho_{pro,\lambda}(i_r)\right>v_\lambda} + \sum_i{\left<\phi_i(i_r)\right>}} \quad \forall r
		\label{eq:esf:pi-ir}
	\end{aligned}
\end{align}

Lo que nos da una ecuaci\'on para cada corona $i_r$, en donde cada posici\'on es descrita por la coordenada $r_i = (i_r -$ 0.5$)\delta$. 
La variable $i_r$ toma valores de $1$ a $n_r$, en donde $n_r$ es un n\'umero suficientemente grande de capas para que se satisfagan las restricciones impuestas en nuestro sistema. Entre ellas
$\rho_\gamma(n_r) \approx \rho_\gamma^b$, $\rho_{pro}(\theta,n_r) \approx \rho_{pro}^b(\theta)$ y $\psi(n_r) \approx \psi^b = 0$.

Con estas consideraciones podemos reescribir:


\begin{align}
	\frac{f(j_r)}{1-f(j_r)}= \left(\frac{a_{H^+}}{k^0_{a,j}}\right)^{-1} e^{-\beta q_{MAA^-}\psi(i_r)}
\end{align}


Para las especies libres, sin considerar la prote\'ina, ecuaci\'on \ref{eq:esf:rho-libres}:

\begin{align}
	\rho_\gamma(i_r)v_w = a_\gamma \exp{[-\beta \psi(i_r)q_\gamma]} \exp{[-\beta\pi(i_r) v_w]}
\end{align}

La densidad local de la prote\'ina  se escribe, ecuaci\'on \ref{eq:esf:rho-pro}:

\begin{align}
	\begin{aligned}
		\rho_{pro}(\theta, i_r)v_w = &\tilde{a}_{pro} \prod_\tau\exp\left[ \sum^{n_r}_{j_r = 1} \tilde{m}_\tau(\theta,i_r,j_r) \ln f_\tau(j_r)\right] \\
		& \hspace{1em} \times \prod_\lambda \exp \left[ \sum^{n_r}_{j_r = 1} \tilde{m}_\lambda(\theta,i_r, j_r)\left(\beta\pi(j_r) v_\lambda+ \beta \psi(j_r)q_\lambda\right) \right]
	\end{aligned}
\end{align}

La probabilidad de las configuraciones de la red polim\'erica $P(\alpha)$: 

\begin{align}
	\begin{aligned}
		P(\alpha)&= \frac{1}{Q}\prod_{r_j}\prod_i \exp\left[{- {\beta\pi(r_j) \tilde{\phi}^i_r(\alpha,r_j)}}\right] \\
		& \times \prod_{r_j} \exp \left[ - \beta \psi(r_j)\frac{\tilde{ \phi}^{MAA}_r(\alpha,r_j)}{v_{MAA}} q_{MAA}  \right] \\
		& \times \prod_{r_j} \exp\left[ - { \ln(f(r_j))\frac{\tilde{ \phi}^{MAA}_r(\alpha,r_j)}{v_{MAA}}}\right] \\
	\end{aligned}
\end{align}

\noindent donde:

\begin{align}
	\tilde{ \phi}^{MAA}_r(\alpha,r_i) = \int_{r_i -\delta/2}^{r_i + \delta/2} dr \, \phi^{MAA}_r(\alpha,r)
\end{align}

La ecuaci\'on de Poisson se escribe:

\begin{align}
	\epsilon \frac{\psi(i_r +1) -2 \psi(i_r) + \psi(i_r -1)}{\delta ^2} + 2\epsilon \frac{\psi(i_r +1) -\psi(i_r)}{(i_r -\frac{1}{2})\delta ^2}= -\left<\rho_q(i_r)\right>
	\label{eq:esf:poisson-ir}
\end{align}

\noindent en donde la densidad de carga se define:

\begin{align}
	\left<\rho_q(i_r)\right> = \sum_{\gamma } {\rho_\gamma(i_r) q_\gamma + \sum_\tau{f_\tau(i_r) \left<\rho_{pro,\tau}(i_r)\right> q_\tau} +  f(i_r)\dfrac{\left<\phi_{MAA}(i_r)\right>}{v_{MAA}}q_{MAA}}
\end{align}

Nuestras condiciones de contorno se reescriben:
\begin{align}
	\psi(n_r) = 0
\end{align}

\begin{align}
\psi(1) = \psi(0)
\end{align}

Definiendo  el pH, concentraci\'on de sal y prote\'ina, temperatura, es posible calcular las variables restantes  $\pi(i_r)$ y $\psi(i_r)$ para cada corona $i_r$.
Cantidades que pueden ser obtenidas al resolver en cada capa las ecuaciones \ref{eq:esf:pi-ir} y \ref{eq:esf:poisson-ir}.
De esta forma el n\'umero de ecuaciones totales a resolver es $2n_r$ (dos por cada capa). 
Este sistema de ecuaciones es resuelto usando el m\'etodo de Newton-Krilov en donde el jacobiano se aproxima num\'ericamente, implementado un c\'odigo FORTRAN desarrollado en el grupo de trabajo.

